{"ast":null,"code":"// password-manager.js\n// ICS 3201 – Secure Password Manager Project\n// \n\nimport { getRandomBytes, stringToBuffer, bufferToString, encodeBuffer, decodeBuffer } from \"./lib.js\";\nconst subtle = globalThis.crypto.subtle;\n\n/**\n * Secure password manager (Keychain)\n * Implements AES-GCM encryption, HMAC domain privacy,\n * PBKDF2 key derivation, swap & rollback protection.\n */\nclass Keychain {\n  constructor(kvs, salt, hmacKey, encKey) {\n    this.kvs = kvs || {}; // in-memory key-value store\n    this.salt = salt; // Base64 string of salt\n    this.hmacKey = hmacKey;\n    this.encKey = encKey;\n  }\n\n  // 1. Initialize a NEW empty keychain\n\n  static async init(password) {\n    const salt = encodeBuffer(getRandomBytes(16)); // 128-bit salt\n    const {\n      hmacKey,\n      encKey\n    } = await Keychain._deriveKeys(password, salt);\n    return new Keychain({}, salt, hmacKey, encKey);\n  }\n\n  // 2. Load from serialized representation\n  static async load(password, representation, trustedDataCheck) {\n    const parsed = JSON.parse(representation);\n    const {\n      kvs,\n      salt\n    } = parsed;\n    const {\n      hmacKey,\n      encKey\n    } = await Keychain._deriveKeys(password, salt);\n\n    // rollback attack defense\n    if (trustedDataCheck !== undefined) {\n      const hashBuf = await subtle.digest(\"SHA-256\", stringToBuffer(JSON.stringify(kvs)));\n      const computed = bufferToString(hashBuf);\n      if (computed !== trustedDataCheck) {\n        throw \"Integrity check failed (possible rollback attack)\";\n      }\n    }\n    const keychain = new Keychain(kvs, salt, hmacKey, encKey);\n\n    // verify password correctness\n    const keys = Object.keys(kvs);\n    if (keys.length > 0) {\n      const sample = kvs[keys[0]];\n      try {\n        await subtle.decrypt({\n          name: \"AES-GCM\",\n          iv: decodeBuffer(sample.iv),\n          additionalData: stringToBuffer(keys[0])\n        }, encKey, decodeBuffer(sample.ciphertext));\n      } catch {\n        //  wrong password: throw instead of return false\n        throw \"Invalid master password\";\n      }\n    }\n    return keychain;\n  }\n\n  // 3. Derive subkeys (HMAC + AES) using PBKDF2\n\n  static async _deriveKeys(password, salt) {\n    const baseKey = await subtle.importKey(\"raw\", stringToBuffer(password), \"PBKDF2\", false, [\"deriveBits\", \"deriveKey\"]);\n    const saltBuf = decodeBuffer(salt);\n    const masterKey = await subtle.deriveBits({\n      name: \"PBKDF2\",\n      salt: saltBuf,\n      iterations: 100000,\n      hash: \"SHA-256\"\n    }, baseKey, 256);\n\n    // Derive two 128-bit subkeys via HMAC of constants\n    const hk = await subtle.importKey(\"raw\", masterKey, {\n      name: \"HMAC\",\n      hash: \"SHA-256\"\n    }, false, [\"sign\"]);\n    const hmacKeyBytes = await subtle.sign(\"HMAC\", hk, stringToBuffer(\"HMACKEY\"));\n    const encKeyBytes = await subtle.sign(\"HMAC\", hk, stringToBuffer(\"ENCKEY\"));\n    const hmacKey = await subtle.importKey(\"raw\", hmacKeyBytes, {\n      name: \"HMAC\",\n      hash: \"SHA-256\"\n    }, false, [\"sign\", \"verify\"]);\n    const encKey = await subtle.importKey(\"raw\", encKeyBytes, \"AES-GCM\", false, [\"encrypt\", \"decrypt\"]);\n    return {\n      hmacKey,\n      encKey\n    };\n  }\n\n  // 4. Add or update a domain-password pair\n  async set(domain, password) {\n    const domainMac = await this._domainHMAC(domain);\n    const iv = getRandomBytes(12);\n    const ivLabel = getRandomBytes(12);\n\n    // pad password to 64 bytes to hide length\n    const paddedPwd = password.padEnd(64, \" \");\n    const cipherBuf = await subtle.encrypt({\n      name: \"AES-GCM\",\n      iv,\n      additionalData: stringToBuffer(domainMac)\n    }, this.encKey, stringToBuffer(paddedPwd));\n\n    // Encrypt a label (the plaintext domain) so UI can list human-readable domains\n    const paddedDomain = domain.padEnd(64, \" \");\n    const labelBuf = await subtle.encrypt({\n      name: \"AES-GCM\",\n      iv: ivLabel,\n      additionalData: stringToBuffer(domainMac)\n    }, this.encKey, stringToBuffer(paddedDomain));\n    this.kvs[domainMac] = {\n      iv: encodeBuffer(iv),\n      ciphertext: encodeBuffer(cipherBuf),\n      labelIv: encodeBuffer(ivLabel),\n      labelCiphertext: encodeBuffer(labelBuf)\n    };\n  }\n\n  // List entries with decrypted domain labels when possible\n  async list() {\n    const entries = [];\n    const keys = Object.keys(this.kvs || {});\n    for (const mac of keys) {\n      const entry = this.kvs[mac];\n      if (!entry) continue;\n      let domainLabel = null;\n      try {\n        const labelPlain = await subtle.decrypt({\n          name: \"AES-GCM\",\n          iv: decodeBuffer(entry.labelIv),\n          additionalData: stringToBuffer(mac)\n        }, this.encKey, decodeBuffer(entry.labelCiphertext));\n        domainLabel = bufferToString(labelPlain).trimEnd();\n      } catch {\n        domainLabel = mac.slice(0, 12) + \"...\";\n      }\n      entries.push({\n        domain: domainLabel,\n        mac\n      });\n    }\n    return entries;\n  }\n\n  // 5. Retrieve decrypted password\n  async get(domain) {\n    const domainMac = await this._domainHMAC(domain);\n    const entry = this.kvs[domainMac];\n    if (!entry) return null;\n    try {\n      const plainBuf = await subtle.decrypt({\n        name: \"AES-GCM\",\n        iv: decodeBuffer(entry.iv),\n        additionalData: stringToBuffer(domainMac)\n      }, this.encKey, decodeBuffer(entry.ciphertext));\n      return bufferToString(plainBuf).trimEnd(); // remove padding\n    } catch {\n      throw \"Decryption or integrity check failed (possible swap/tamper)\";\n    }\n  }\n\n  // 6. Remove entry\n  async remove(domain) {\n    const domainMac = await this._domainHMAC(domain);\n    if (this.kvs[domainMac]) {\n      delete this.kvs[domainMac];\n      return true;\n    }\n    return false;\n  }\n\n  // 7. Serialize keychain + hash\n  async dump() {\n    const kvsJSON = JSON.stringify(this.kvs);\n    const hashBuf = await subtle.digest(\"SHA-256\", stringToBuffer(kvsJSON));\n    const checksum = bufferToString(hashBuf);\n    const repr = JSON.stringify({\n      kvs: this.kvs,\n      salt: this.salt,\n      checksum\n    });\n    return [repr, checksum];\n  }\n\n  // 8. Internal helper: compute domain HMAC\n  async _domainHMAC(domain) {\n    const macBuf = await subtle.sign(\"HMAC\", this.hmacKey, stringToBuffer(domain));\n    return encodeBuffer(macBuf);\n  }\n}\n\n// Export class for testing\nexport { Keychain };","map":{"version":3,"names":["getRandomBytes","stringToBuffer","bufferToString","encodeBuffer","decodeBuffer","subtle","globalThis","crypto","Keychain","constructor","kvs","salt","hmacKey","encKey","init","password","_deriveKeys","load","representation","trustedDataCheck","parsed","JSON","parse","undefined","hashBuf","digest","stringify","computed","keychain","keys","Object","length","sample","decrypt","name","iv","additionalData","ciphertext","baseKey","importKey","saltBuf","masterKey","deriveBits","iterations","hash","hk","hmacKeyBytes","sign","encKeyBytes","set","domain","domainMac","_domainHMAC","ivLabel","paddedPwd","padEnd","cipherBuf","encrypt","paddedDomain","labelBuf","labelIv","labelCiphertext","list","entries","mac","entry","domainLabel","labelPlain","trimEnd","slice","push","get","plainBuf","remove","dump","kvsJSON","checksum","repr","macBuf"],"sources":["C:/Users/emman/FIFA 19 Dropbox/Emmanuel Amor/PC/Downloads/proj1 (1)/Proj1/password-manager-ui/src/password-manager.js"],"sourcesContent":["// password-manager.js\n// ICS 3201 – Secure Password Manager Project\n// \n\nimport {\n  getRandomBytes,\n  stringToBuffer,\n  bufferToString,\n  encodeBuffer,\n  decodeBuffer,\n} from \"./lib.js\";\n\nconst subtle = globalThis.crypto.subtle;\n\n/**\n * Secure password manager (Keychain)\n * Implements AES-GCM encryption, HMAC domain privacy,\n * PBKDF2 key derivation, swap & rollback protection.\n */\nclass Keychain {\n  constructor(kvs, salt, hmacKey, encKey) {\n    this.kvs = kvs || {}; // in-memory key-value store\n    this.salt = salt; // Base64 string of salt\n    this.hmacKey = hmacKey;\n    this.encKey = encKey;\n  }\n\n  // 1. Initialize a NEW empty keychain\n\n  static async init(password) {\n    const salt = encodeBuffer(getRandomBytes(16)); // 128-bit salt\n    const { hmacKey, encKey } = await Keychain._deriveKeys(password, salt);\n    return new Keychain({}, salt, hmacKey, encKey);\n  }\n\n  // 2. Load from serialized representation\n    static async load(password, representation, trustedDataCheck) {\n    const parsed = JSON.parse(representation);\n    const { kvs, salt } = parsed;\n    const { hmacKey, encKey } = await Keychain._deriveKeys(password, salt);\n\n    // rollback attack defense\n    if (trustedDataCheck !== undefined) {\n      const hashBuf = await subtle.digest(\n        \"SHA-256\",\n        stringToBuffer(JSON.stringify(kvs))\n      );\n      const computed = bufferToString(hashBuf);\n      if (computed !== trustedDataCheck) {\n        throw \"Integrity check failed (possible rollback attack)\";\n      }\n    }\n\n    const keychain = new Keychain(kvs, salt, hmacKey, encKey);\n\n// verify password correctness\nconst keys = Object.keys(kvs);\nif (keys.length > 0) {\n  const sample = kvs[keys[0]];\n  try {\n    await subtle.decrypt(\n      {\n        name: \"AES-GCM\",\n        iv: decodeBuffer(sample.iv),\n        additionalData: stringToBuffer(keys[0]),\n      },\n      encKey,\n      decodeBuffer(sample.ciphertext)\n    );\n  } catch {\n    //  wrong password: throw instead of return false\n    throw \"Invalid master password\";\n  }\n}\n\n    return keychain;\n  }\n\n\n\n  // 3. Derive subkeys (HMAC + AES) using PBKDF2\n\n  static async _deriveKeys(password, salt) {\n    const baseKey = await subtle.importKey(\n      \"raw\",\n      stringToBuffer(password),\n      \"PBKDF2\",\n      false,\n      [\"deriveBits\", \"deriveKey\"]\n    );\n\n    const saltBuf = decodeBuffer(salt);\n\n    const masterKey = await subtle.deriveBits(\n      {\n        name: \"PBKDF2\",\n        salt: saltBuf,\n        iterations: 100000,\n        hash: \"SHA-256\",\n      },\n      baseKey,\n      256\n    );\n\n    // Derive two 128-bit subkeys via HMAC of constants\n    const hk = await subtle.importKey(\n      \"raw\",\n      masterKey,\n      { name: \"HMAC\", hash: \"SHA-256\" }, \n      false,\n      [\"sign\"]\n    );\n\n    const hmacKeyBytes = await subtle.sign(\"HMAC\", hk, stringToBuffer(\"HMACKEY\"));\n    const encKeyBytes = await subtle.sign(\"HMAC\", hk, stringToBuffer(\"ENCKEY\"));\n\n    const hmacKey = await subtle.importKey(\n      \"raw\",\n      hmacKeyBytes,\n      { name: \"HMAC\", hash: \"SHA-256\" }, \n      false,\n      [\"sign\", \"verify\"]\n    );\n\n    const encKey = await subtle.importKey(\n      \"raw\",\n      encKeyBytes,\n      \"AES-GCM\",\n      false,\n      [\"encrypt\", \"decrypt\"]\n    );\n\n    return { hmacKey, encKey };\n  }\n\n\n  \n  // 4. Add or update a domain-password pair\n  async set(domain, password) {\n    const domainMac = await this._domainHMAC(domain);\n    const iv = getRandomBytes(12);\n    const ivLabel = getRandomBytes(12);\n\n    // pad password to 64 bytes to hide length\n    const paddedPwd = password.padEnd(64, \" \");\n    const cipherBuf = await subtle.encrypt(\n      {\n        name: \"AES-GCM\",\n        iv,\n        additionalData: stringToBuffer(domainMac),\n      },\n      this.encKey,\n      stringToBuffer(paddedPwd)\n    );\n\n    // Encrypt a label (the plaintext domain) so UI can list human-readable domains\n    const paddedDomain = domain.padEnd(64, \" \");\n    const labelBuf = await subtle.encrypt(\n      {\n        name: \"AES-GCM\",\n        iv: ivLabel,\n        additionalData: stringToBuffer(domainMac),\n      },\n      this.encKey,\n      stringToBuffer(paddedDomain)\n    );\n\n    this.kvs[domainMac] = {\n      iv: encodeBuffer(iv),\n      ciphertext: encodeBuffer(cipherBuf),\n      labelIv: encodeBuffer(ivLabel),\n      labelCiphertext: encodeBuffer(labelBuf),\n    };\n  }\n \n\n  // List entries with decrypted domain labels when possible\n  async list() {\n    const entries = [];\n    const keys = Object.keys(this.kvs || {});\n    for (const mac of keys) {\n      const entry = this.kvs[mac];\n      if (!entry) continue;\n      let domainLabel = null;\n      try {\n        const labelPlain = await subtle.decrypt(\n          {\n            name: \"AES-GCM\",\n            iv: decodeBuffer(entry.labelIv),\n            additionalData: stringToBuffer(mac),\n          },\n          this.encKey,\n          decodeBuffer(entry.labelCiphertext)\n        );\n        domainLabel = bufferToString(labelPlain).trimEnd();\n      } catch {\n        domainLabel = mac.slice(0, 12) + \"...\";\n      }\n      entries.push({ domain: domainLabel, mac });\n    }\n    return entries;\n  }\n \n  \n  // 5. Retrieve decrypted password\n  async get(domain) {\n    const domainMac = await this._domainHMAC(domain);\n    const entry = this.kvs[domainMac];\n    if (!entry) return null;\n\n    try {\n      const plainBuf = await subtle.decrypt(\n        {\n          name: \"AES-GCM\",\n          iv: decodeBuffer(entry.iv),\n          additionalData: stringToBuffer(domainMac),\n        },\n        this.encKey,\n        decodeBuffer(entry.ciphertext)\n      );\n\n      return bufferToString(plainBuf).trimEnd(); // remove padding\n    } catch {\n      throw \"Decryption or integrity check failed (possible swap/tamper)\";\n    }\n  }\n\n  // 6. Remove entry\n  async remove(domain) {\n    const domainMac = await this._domainHMAC(domain);\n    if (this.kvs[domainMac]) {\n      delete this.kvs[domainMac];\n      return true;\n    }\n    return false;\n  }\n\n  \n  // 7. Serialize keychain + hash\n  async dump() {\n    const kvsJSON = JSON.stringify(this.kvs);\n    const hashBuf = await subtle.digest(\"SHA-256\", stringToBuffer(kvsJSON));\n    const checksum = bufferToString(hashBuf);\n\n    const repr = JSON.stringify({\n      kvs: this.kvs,\n      salt: this.salt,\n      checksum,\n    });\n\n    return [repr, checksum];\n  }\n\n  // 8. Internal helper: compute domain HMAC\n  async _domainHMAC(domain) {\n    const macBuf = await subtle.sign(\"HMAC\", this.hmacKey, stringToBuffer(domain));\n    return encodeBuffer(macBuf);\n  }\n}\n\n// Export class for testing\nexport { Keychain };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}